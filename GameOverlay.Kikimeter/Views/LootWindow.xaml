<Window x:Class="GameOverlay.Kikimeter.Views.LootWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        mc:Ignorable="d"
        Title="Loot"
        Height="550"
        Width="300"
        WindowStyle="None"
        AllowsTransparency="True"
        ResizeMode="CanResize"
        Topmost="True"
        ShowInTaskbar="False"
        UseLayoutRounding="True"
        SnapsToDevicePixels="True"
        RenderOptions.BitmapScalingMode="HighQuality"
        MinWidth="280"
        MinHeight="500" Cursor="">
    <Window.Resources>
        <SolidColorBrush x:Key="CyanAccentBrush" Color="#FF6E5C2A" />
        <SolidColorBrush x:Key="SectionBackgroundBrush" Color="#80000000" />
    </Window.Resources>
    <Window.Background>
        <ImageBrush ImageSource="/GameOverlay.Kikimeter;component/Views/EndTurnWidgetBackground.png" Stretch="Fill"/>
    </Window.Background>
    <FrameworkElement.LayoutTransform>
        <ScaleTransform x:Name="WindowScale" ScaleX="1" ScaleY="1" />
    </FrameworkElement.LayoutTransform>
    <Border x:Name="MainBorder"
            BorderThickness="1"
            BorderBrush="#FF6E5C2A"
            CornerRadius="10"
            Padding="0"
            SnapsToDevicePixels="True"
            Background="Transparent"
            MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
        <Grid x:Name="MainGrid" Background="Transparent">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- En-tête avec titre et bouton fermer -->
            <Grid Grid.Row="0" Margin="4,10,15,15" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0"
                           Text="Loot"
                           FontSize="18"
                           FontWeight="Bold"
                           Foreground="#FFDAC390"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Center"
                           Margin="0,0,40,0"/>
                <Image Grid.Column="1"
                       Source="/GameOverlay.Kikimeter;component/Views/Assets/utilities/fermeture.png"
                       Width="28"
                       Height="28"
                       VerticalAlignment="Center"
                       HorizontalAlignment="Right"
                       Cursor="Hand"
                       MouseLeftButtonDown="CloseButton_Click"
                       Stretch="Uniform" Margin="0,5,0,0"/>
            </Grid>

            <!-- Liste des items de loot -->
            <Border Grid.Row="1"
                    BorderBrush="#FF6E5C2A"
                    BorderThickness="1"
                    CornerRadius="4"
                    Margin="15,0,15,15"
                    Background="{DynamicResource SectionBackgroundBrush}">
                <ScrollViewer VerticalScrollBarVisibility="Auto"
                              HorizontalScrollBarVisibility="Disabled"
                              Padding="10">
                    <ItemsControl x:Name="LootItemsContainer">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderThickness="1"
                                        Margin="0,2,0,2"
                                        Padding="10,8"
                                        Background="{DynamicResource SectionBackgroundBrush}"
                                        CornerRadius="3">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="BorderBrush" Value="#FF6E5C2A"/>
                                            <Setter Property="Opacity" Value="1.0"/>
                                            <Style.Triggers>
                                                <MultiDataTrigger>
                                                    <MultiDataTrigger.Conditions>
                                                        <Condition Binding="{Binding IsFavorite}" Value="True"/>
                                                        <Condition Binding="{Binding Quantity}" Value="0"/>
                                                    </MultiDataTrigger.Conditions>
                                                    <Setter Property="BorderBrush" Value="#FF888888"/>
                                                    <Setter Property="Opacity" Value="0.6"/>
                                                </MultiDataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" MinWidth="44" />
                                            <ColumnDefinition Width="*" MinWidth="120" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <Button Grid.Column="0"
                                                Width="40"
                                                Height="40"
                                                MinWidth="40"
                                                MinHeight="40"
                                                Background="Transparent"
                                                BorderThickness="0"
                                                Padding="8"
                                                Cursor="Hand"
                                                PreviewMouseDown="ToggleFavorite_PreviewMouseDown"
                                                Tag="{Binding}"
                                                ToolTip="Marquer comme favoris"
                                                VerticalAlignment="Center"
                                                HorizontalAlignment="Center"
                                                Margin="0,0,5,0"
                                                Focusable="False">
                                            <Button.Style>
                                                <Style TargetType="Button">
                                                    <Setter Property="Template">
                                                        <Setter.Value>
                                                            <ControlTemplate TargetType="Button">
                                                                <Border Background="Transparent"
                                                                        BorderThickness="0"
                                                                        CornerRadius="0">
                                                                    <ContentPresenter HorizontalAlignment="Center"
                                                                                      VerticalAlignment="Center" />
                                                                </Border>
                                                            </ControlTemplate>
                                                        </Setter.Value>
                                                    </Setter>
                                                    <Setter Property="Foreground" Value="#FF888888"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsFavorite}" Value="True">
                                                            <Setter Property="Foreground" Value="#FFFFD700"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Button.Style>
                                            <TextBlock Text="★"
                                                       FontSize="22"
                                                       FontWeight="Bold"
                                                       VerticalAlignment="Center"
                                                       HorizontalAlignment="Center"/>
                                        </Button>
                                        <TextBlock Grid.Column="1"
                                                   Text="{Binding ItemName}"
                                                   FontSize="14"
                                                   FontWeight="Bold"
                                                   TextWrapping="Wrap"
                                                   VerticalAlignment="Center"
                                                   Margin="0,0,8,0"
                                                   TextTrimming="CharacterEllipsis">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="#FF4E421F"/>
                                                    <Style.Triggers>
                                                        <MultiDataTrigger>
                                                            <MultiDataTrigger.Conditions>
                                                                <Condition Binding="{Binding IsFavorite}" Value="True"/>
                                                                <Condition Binding="{Binding Quantity}" Value="0"/>
                                                            </MultiDataTrigger.Conditions>
                                                            <Setter Property="Foreground" Value="#FF888888"/>
                                                            <Setter Property="FontStyle" Value="Italic"/>
                                                        </MultiDataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                        <TextBlock Grid.Column="2"
                                                   Text="{Binding Quantity, StringFormat=x\{0\}}"
                                                   FontSize="16"
                                                   FontWeight="Bold"
                                                   VerticalAlignment="Center"
                                                   Margin="5,0,5,0"
                                                   MinWidth="35">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="#FF4E421F"/>
                                                    <Style.Triggers>
                                                        <MultiDataTrigger>
                                                            <MultiDataTrigger.Conditions>
                                                                <Condition Binding="{Binding IsFavorite}" Value="True"/>
                                                                <Condition Binding="{Binding Quantity}" Value="0"/>
                                                            </MultiDataTrigger.Conditions>
                                                            <Setter Property="Foreground" Value="#FF888888"/>
                                                            <Setter Property="FontStyle" Value="Italic"/>
                                                        </MultiDataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                        <Button Grid.Column="3"
                                                Width="32"
                                                Height="32"
                                                MinWidth="32"
                                                MinHeight="32"
                                                Background="Transparent"
                                                BorderThickness="0"
                                                Padding="4"
                                                Cursor="Hand"
                                                Click="DeleteLootItem_Click"
                                                Tag="{Binding}"
                                                ToolTip="Supprimer cet item"
                                                VerticalAlignment="Center"
                                                HorizontalAlignment="Center"
                                                Margin="5,0,0,0"
                                                Focusable="False">
                                            <Button.Style>
                                                <Style TargetType="Button">
                                                    <Setter Property="Template">
                                                        <Setter.Value>
                                                            <ControlTemplate TargetType="Button">
                                                                <Border Background="Transparent"
                                                                        BorderThickness="0"
                                                                        CornerRadius="0">
                                                                    <ContentPresenter HorizontalAlignment="Center"
                                                                                      VerticalAlignment="Center" />
                                                                </Border>
                                                            </ControlTemplate>
                                                        </Setter.Value>
                                                    </Setter>
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsFavorite}" Value="True">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Button.Style>
                                            <Image Source="/GameOverlay.Kikimeter;component/Views/Assets/loot/cross.png"
                                                   Width="24"
                                                   Height="24"
                                                   Stretch="Uniform"
                                                   RenderOptions.BitmapScalingMode="HighQuality"/>
                                        </Button>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Border>

            <!-- Barre de statut -->
            <Border Grid.Row="2"
                    BorderBrush="#FF6E5C2A"
                    BorderThickness="0,1,0,0"
                    Padding="15,10"
                    Margin="15,0,15,15"
                    Background="{DynamicResource SectionBackgroundBrush}">
                <TextBlock x:Name="StatusText"
                           Text="Aucun loot détecté"
                           FontSize="12"
                           FontWeight="Normal"
                           Foreground="#FF4E421F"
                           HorizontalAlignment="Left"
                           VerticalAlignment="Center"
                           TextWrapping="Wrap"/>
            </Border>
        </Grid>
    </Border>
</Window>
